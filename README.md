# Time_detector
Главная идея работы: "Как при помощи нейронной сети определять время по фотографии стрелочных часов?"  
На данный момент существуют два общих подхода, позволяющих решить такую задачу:  
1) Обучить нейросеть на большом количестве размеченных фотографий предсказывать время;
2) Детектирование положения стрелок на плоскости фотографии и последующий аналитический расчет времени.  

Мы попробовали оба этих подхода и сделали выводы о  том, какой подход лучше.
## Обучение нейросети
<img width="300" height="600" src="Analytical_Method/vis/bot.gif">  

## Аналитический метод
Рассмотрим подробнее этапы детектирования времени в аналитическом методе:
1) При помощи предобученной на COCO сети "fаster_rcnn" детектируются часы на входном изображении. После этого они локализуются и отправляются на следующих этап;
2) Обрезанное изображение поступает на две сети:  
2.1  Модель для сегментации "mask_rcnn", обученная на 180 (до аугментации) изображениях часов с размеченными стрелками.  
Данная модель сегментирует стрелки на изображении. Далее из полученных масок методом наименьших квадратов определяются линейные уравнения стрелок. По уравнениям определяется точка их пересечения, которая принимается за центр часов. Помимо, этого находим координаты начала и конца стрелок и проводим проверку по длине (длина часовой стрелки должна быть меньше, чем длина минутной стрелки. В противном случае метки стрелок меняются);  
2.2 Модель для детекции положения чисел на циферблате "faster_rcnn", обученная на 180 (до аугментации) изображениях часов с размеченными числами.  
Данная модель детектирует числа на циферблате, далее выбирается наиболее вероятное число, которому соответствуют координаты центра сдетектированного прямоугольника. После этого, по уравнению окружности в сферической системе координат определяется положение чисел 12 и 3 на циферблате (зная метку класса первоначально полученного числа переходим к 12 и 3 поворотом координат числа, относительно центра окружности из п.2.1, на угол кратный 30 градусам);  
(*Замечание*. Из-за ошибок в метадате классы интерпретируются не интуитивно. Настоящие классы соотносятся так: {1: 1, 8: 2, 9: 3, 10: 4, 11: 5, 12: 6, 2: 7, 3: 8, 4: 9, 5: 10, 6: 11, 7: 0})  
3) Зная координаты центра окружности, чисел 12, 3 и концов стрелок определяем время по 4 углам (2 для минутной и 2 для часовой стрелки).  

<p><img align="left" width="1280" height="500" src="Analytical_Method/vis/top.jpg"></p>
<p><img align="left" src="Analytical_Method/vis/top2.png"></p>
<p><img align="left" src="Analytical_Method/vis/top4.png"></p>
